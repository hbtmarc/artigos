---
import BaseLayout from '../layouts/BaseLayout.astro';
import { withBase } from '../lib/withBase';

const homeHref = withBase('');
const validTypes = ['artigo', 'roteiro', 'plano-diretor'] as const;
const typeParam = Astro.url.searchParams.get('type') ?? '';
const selectedType = validTypes.includes(typeParam as (typeof validTypes)[number])
  ? typeParam
  : 'all';
const filterOptions = [
  { label: 'Todos', value: 'all' },
  { label: 'Artigos', value: 'artigo' },
  { label: 'Roteiros', value: 'roteiro' },
  { label: 'Planos Diretores', value: 'plano-diretor' }
];
---
<BaseLayout title="Artigos" description="Leituras longas e ensaios visuais para inspirar." >
  <section class="hero">
    <h1>Artigos longos, ideias com calma.</h1>
    <p>
      Um laboratorio de leitura lenta, textos em andamento e anotacoes organizadas para
      virar publicado com consistencia.
    </p>
  </section>

  <h2 class="section-title">Em destaque</h2>
  <section class="filter-bar">
    <p class="filter-label">Filtrar por tipo</p>
    <div class="filter-chips">
      {filterOptions.map((option) => {
        const isActive = option.value === selectedType;
        const href = option.value === 'all' ? homeHref : `${homeHref}?type=${option.value}`;
        return (
          <a
            class={`filter-chip ${isActive ? 'is-active' : ''}`}
            href={href}
            data-filter-chip={option.value}
            aria-current={isActive ? 'page' : undefined}
          >
            {option.label}
          </a>
        );
      })}
    </div>
  </section>
  <div class="post-list" data-post-list>
    <article class="post-card post-card--skeleton">
      <div class="post-card-header">
        <span class="post-badge">Carregando</span>
        <span class="post-date">...</span>
      </div>
      <h3>Carregando posts publicados...</h3>
      <p class="post-excerpt">Carregando...</p>
    </article>
    <article class="post-card post-card--skeleton">
      <div class="post-card-header">
        <span class="post-badge">Carregando</span>
        <span class="post-date">...</span>
      </div>
      <h3>Carregando posts publicados...</h3>
      <p class="post-excerpt">Carregando...</p>
    </article>
    <article class="post-card post-card--skeleton">
      <div class="post-card-header">
        <span class="post-badge">Carregando</span>
        <span class="post-date">...</span>
      </div>
      <h3>Carregando posts publicados...</h3>
      <p class="post-excerpt">Carregando...</p>
    </article>
  </div>
  <script src="../scripts/public-posts.ts"></script>
</BaseLayout>
