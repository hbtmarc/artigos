const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/firestore.3eO7oRFa.js","_astro/index.esm2017.BeiKNkIx.js","_astro/client.DCNKASv_.js"])))=>i.map(i=>d[i]);
import{_ as tt}from"./preload-helper.COgNFeIc.js";import{o as gt,s as vt,a as Et,b as yt,g as ht,d as It}from"./index.esm2017.BeiKNkIx.js";console.log("admin script loaded");document.addEventListener("DOMContentLoaded",async()=>{let i=null,S=null,I=null,b=new Map,m=!1;const H=document.getElementById("login-form"),W=document.getElementById("email"),k=document.getElementById("password"),f=document.getElementById("status"),B=document.getElementById("loggedOut"),w=document.getElementById("logged"),$=document.getElementById("btn-reset"),G=document.getElementById("btn-logout"),C=document.getElementById("user-email"),P=document.getElementById("user-uid"),x=document.getElementById("admin-status"),A=document.getElementById("admin-note"),g=document.getElementById("post-count"),c=document.getElementById("editorial-panel"),d=document.getElementById("editor-panel"),l=document.getElementById("posts-list"),J=document.getElementById("btn-new-post"),K=document.getElementById("btn-back"),L=document.getElementById("post-form"),u=document.getElementById("post-slug"),_=document.getElementById("post-title"),V=document.getElementById("post-excerpt"),y=document.getElementById("post-type"),D=document.getElementById("post-tags"),p=document.getElementById("post-status"),h=document.getElementById("post-content"),Q=document.getElementById("btn-save"),X=document.getElementById("btn-publish"),et={"auth/wrong-password":"Senha incorreta. Tente novamente.","auth/user-not-found":"Usuario nao encontrado para este email.","auth/unauthorized-domain":"Dominio nao autorizado. Adicione este dominio nas configuracoes do Firebase.","auth/invalid-email":"Email invalido. Verifique e tente novamente.","auth/too-many-requests":"Muitas tentativas. Aguarde alguns minutos antes de tentar de novo."},nt={artigo:"Artigo",roteiro:"Roteiro","plano-diretor":"Plano Diretor"},n=(t,e="info")=>{if(f){if(!t){f.textContent="",f.hidden=!0,f.dataset.kind="";return}f.textContent=t,f.hidden=!1,f.dataset.kind=e}},F=t=>{if(!t||typeof t!="object")return"Nao foi possivel concluir.";const e=t.code||"";return et[e]||"Nao foi possivel concluir."},Y=t=>{m=t,x&&(x.textContent=t?"SIM":"NAO"),A&&(A.hidden=t),!t&&g&&(g.textContent="-"),c&&(c.hidden=!t),d&&(d.hidden=!0)},ot=t=>{B&&(B.hidden=!0),w&&(w.hidden=!1),C&&(C.textContent=t.email||"-"),P&&(P.textContent=t.uid)},at=()=>{B&&(B.hidden=!1),w&&(w.hidden=!0),C&&(C.textContent=""),P&&(P.textContent=""),x&&(x.textContent="-"),A&&(A.hidden=!0),g&&(g.textContent="-"),c&&(c.hidden=!0),d&&(d.hidden=!0),l&&(l.innerHTML=""),b.clear()},st=t=>!t||typeof t.toDate!="function"?"-":new Intl.DateTimeFormat("pt-BR",{dateStyle:"medium"}).format(t.toDate()),T=(t,e,o="admin-post-cell")=>{const a=document.createElement("div");a.className=o;const s=document.createElement("span");s.className="admin-post-label",s.textContent=t;const r=document.createElement("span");return r.className="admin-post-value",r.textContent=e,a.append(s,r),a},it=t=>{const e=document.createElement("div");e.className="admin-post-row";const o=document.createElement("div");o.className="admin-post-title";const a=document.createElement("span");a.className="admin-post-label",a.textContent="Titulo";const s=document.createElement("span");s.className="admin-post-value",s.textContent=t.title;const r=document.createElement("span");r.className="admin-post-id",r.textContent=t.id,o.append(a,s,r);const q=T("Status",t.status),z=T("Tipo",nt[t.type]??t.type),U=T("Atualizado",st(t.updatedAt)),j=document.createElement("div");j.className="admin-post-actions";const v=document.createElement("button");v.type="button",v.className="admin-action",v.dataset.action="edit",v.dataset.id=t.id,v.textContent="Editar";const E=document.createElement("button");return E.type="button",E.className="admin-action is-danger",E.dataset.action="delete",E.dataset.id=t.id,E.textContent="Excluir",j.append(v,E),e.append(o,q,z,U,j),e},rt=t=>{if(l){if(l.innerHTML="",b=new Map,!t.length){const e=document.createElement("p");e.className="admin-empty",e.textContent="Nenhum post encontrado.",l.appendChild(e);return}t.forEach(e=>{b.set(e.id,e),l.appendChild(it(e))})}},M=()=>{c&&(c.hidden=!m),d&&(d.hidden=!0)},Z=()=>{c&&(c.hidden=!0),d&&(d.hidden=!1)},ct=()=>{L&&L.reset(),u&&(u.readOnly=!1,u.classList.remove("is-readonly")),p&&(p.value="draft"),y&&(y.value="artigo"),h&&(h.value="")},dt=t=>{u&&(u.value=t.id,u.readOnly=!0,u.classList.add("is-readonly")),_&&(_.value=t.title),V&&(V.value=t.excerpt),y&&(y.value=t.type),D&&(D.value=t.tags.join(", ")),p&&(p.value=t.status),h&&(h.value=t.content)},lt=t=>/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(t),ut=t=>{const e=u?.value?.trim()??"";if(!e)return n("Slug obrigatorio.","error"),null;if(!lt(e))return n("Slug deve ser kebab-case.","error"),null;const o=_?.value?.trim()??"";if(!o)return n("Titulo obrigatorio.","error"),null;const a=V?.value?.trim()??"",s=y?.value||"artigo",r=(D?.value||"").split(",").map(U=>U.trim()).filter(Boolean),q=t||p?.value||"draft",z=h?.value??"";return{id:e,title:o,excerpt:a,type:s,tags:r,status:q,content:z}},N=async()=>{if(I)return I;const t=await tt(()=>import("./firestore.3eO7oRFa.js"),__vite__mapDeps([0,1,2]));return I={listAllPostsAdmin:t.listAllPostsAdmin,getPostById:t.getPostById,upsertPostAdmin:t.upsertPostAdmin,deletePostAdmin:t.deletePostAdmin},I},R=async()=>{if(m)try{const e=await(await N()).listAllPostsAdmin();rt(e),g&&(g.textContent=String(e.length)),M()}catch(t){console.log(t),n("Nao foi possivel carregar posts.","error")}},mt=async t=>{if(m)try{const e=await N(),o=b.get(t)??await e.getPostById(t);if(!o){n("Post nao encontrado.","error");return}dt(o),Z()}catch(e){console.log(e),n("Nao foi possivel abrir o post.","error")}},O=async t=>{if(!m){n("Acesso admin necessario.","error");return}const e=ut(t);if(e){t&&p&&(p.value=t);try{await(await N()).upsertPostAdmin(e),n(t==="published"?"Post publicado.":"Post salvo.","success"),await R(),M()}catch(o){console.log(o),n("Nao foi possivel salvar o post.","error")}}},ft=async t=>{if(!m){n("Acesso admin necessario.","error");return}if(window.confirm("Excluir este post?"))try{await(await N()).deletePostAdmin(t),n("Post removido.","success"),await R()}catch(o){console.log(o),n("Nao foi possivel excluir o post.","error")}},pt=async t=>{if(!S)return!1;try{const e=await ht(It(S,"admins",t)),o=e.exists()?e.data():null,a=!!(o&&o.active===!0);return Y(a),a}catch(e){return console.log(e),Y(!1),n("Nao foi possivel verificar permissao de admin.","error"),!1}};await(async()=>{try{const t=await tt(()=>import("./client.DCNKASv_.js"),__vite__mapDeps([2,1]));return i=t.auth,S=t.db,!0}catch(t){console.log(t);const e=t instanceof Error?t.message:"Configuracao Firebase invalida. Verifique as variaveis de ambiente.";return n(e,"error"),!1}})()&&i&&gt(i,t=>{t?(ot(t),n("Login ativo.","success"),pt(t.uid).then(e=>{e&&R()})):(at(),n("","info"))}),H&&H.addEventListener("submit",async t=>{if(t.preventDefault(),!i){n("Configuracao Firebase invalida. Verifique as variaveis de ambiente.","error");return}const e=W?.value?.trim(),o=k?.value||"";if(!e||!o){n("Preencha email e senha para entrar.","error");return}try{await vt(i,e,o),n("Login realizado.","success"),k&&(k.value="")}catch(a){console.log(a),n(F(a),"error")}}),$&&$.addEventListener("click",async()=>{if(!i){n("Configuracao Firebase invalida. Verifique as variaveis de ambiente.","error");return}const t=W?.value?.trim();if(!t){n("Informe o email para enviar o reset.","error");return}try{await Et(i,t),n("Email de recuperacao enviado.","success")}catch(e){console.log(e),n(F(e),"error")}}),G&&G.addEventListener("click",async()=>{if(!i){n("Configuracao Firebase invalida. Verifique as variaveis de ambiente.","error");return}try{await yt(i),n("Sessao encerrada.","info")}catch(t){console.log(t),n(F(t),"error")}}),J&&J.addEventListener("click",()=>{m&&(ct(),Z())}),K&&K.addEventListener("click",()=>{M()}),L&&L.addEventListener("submit",t=>{t.preventDefault(),O()}),Q&&Q.addEventListener("click",()=>{O()}),X&&X.addEventListener("click",()=>{O("published")}),l&&l.addEventListener("click",t=>{const o=t.target?.closest("button");if(!o)return;const a=o.dataset.action,s=o.dataset.id;!a||!s||(a==="edit"&&mt(s),a==="delete"&&ft(s))})});
