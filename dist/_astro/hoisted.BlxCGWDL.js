const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/firestore.3eO7oRFa.js","_astro/index.esm2017.BeiKNkIx.js","_astro/client.DCNKASv_.js"])))=>i.map(i=>d[i]);
import{_ as et,w as vt}from"./withBase.BubNOM90.js";import{o as Et,s as yt,a as ht,b as It,g as bt,d as wt}from"./index.esm2017.BeiKNkIx.js";console.log("admin script loaded");document.addEventListener("DOMContentLoaded",async()=>{let i=null,k=null,I=null,b=new Map,m=!1;const $=document.getElementById("login-form"),W=document.getElementById("email"),V=document.getElementById("password"),f=document.getElementById("status"),w=document.getElementById("loggedOut"),B=document.getElementById("logged"),G=document.getElementById("btn-reset"),J=document.getElementById("btn-logout"),C=document.getElementById("user-email"),P=document.getElementById("user-uid"),x=document.getElementById("admin-status"),A=document.getElementById("admin-note"),g=document.getElementById("post-count"),c=document.getElementById("editorial-panel"),d=document.getElementById("editor-panel"),l=document.getElementById("posts-list"),K=document.getElementById("btn-new-post"),Q=document.getElementById("btn-back"),L=document.getElementById("post-form"),u=document.getElementById("post-slug"),_=document.getElementById("post-title"),D=document.getElementById("post-excerpt"),y=document.getElementById("post-type"),F=document.getElementById("post-tags"),p=document.getElementById("post-status"),h=document.getElementById("post-content"),X=document.getElementById("btn-save"),Y=document.getElementById("btn-publish"),nt={"auth/wrong-password":"Senha incorreta. Tente novamente.","auth/user-not-found":"Usuario nao encontrado para este email.","auth/unauthorized-domain":"Dominio nao autorizado. Adicione este dominio nas configuracoes do Firebase.","auth/invalid-email":"Email invalido. Verifique e tente novamente.","auth/too-many-requests":"Muitas tentativas. Aguarde alguns minutos antes de tentar de novo."},ot={artigo:"Artigo",roteiro:"Roteiro","plano-diretor":"Plano Diretor"},n=(t,e="info")=>{if(f){if(!t){f.textContent="",f.hidden=!0,f.dataset.kind="";return}f.textContent=t,f.hidden=!1,f.dataset.kind=e}},T=t=>{if(!t||typeof t!="object")return"Nao foi possivel concluir.";const e=t.code||"";return nt[e]||"Nao foi possivel concluir."},Z=t=>{m=t,x&&(x.textContent=t?"SIM":"NAO"),A&&(A.hidden=t),!t&&g&&(g.textContent="-"),c&&(c.hidden=!t),d&&(d.hidden=!0)},at=t=>{w&&(w.hidden=!0),B&&(B.hidden=!1),C&&(C.textContent=t.email||"-"),P&&(P.textContent=t.uid)},st=()=>{w&&(w.hidden=!1),B&&(B.hidden=!0),C&&(C.textContent=""),P&&(P.textContent=""),x&&(x.textContent="-"),A&&(A.hidden=!0),g&&(g.textContent="-"),c&&(c.hidden=!0),d&&(d.hidden=!0),l&&(l.innerHTML=""),b.clear()},it=t=>!t||typeof t.toDate!="function"?"-":new Intl.DateTimeFormat("pt-BR",{dateStyle:"medium"}).format(t.toDate()),M=(t,e,o="admin-post-cell")=>{const a=document.createElement("div");a.className=o;const s=document.createElement("span");s.className="admin-post-label",s.textContent=t;const r=document.createElement("span");return r.className="admin-post-value",r.textContent=e,a.append(s,r),a},rt=t=>{const e=document.createElement("div");e.className="admin-post-row";const o=document.createElement("div");o.className="admin-post-title";const a=document.createElement("span");a.className="admin-post-label",a.textContent="Titulo";const s=document.createElement("span");s.className="admin-post-value",s.textContent=t.title;const r=document.createElement("span");r.className="admin-post-id",r.textContent=t.id,o.append(a,s,r);const z=M("Status",t.status),U=M("Tipo",ot[t.type]??t.type),j=M("Atualizado",it(t.updatedAt)),H=document.createElement("div");H.className="admin-post-actions";const v=document.createElement("button");v.type="button",v.className="admin-action",v.dataset.action="edit",v.dataset.id=t.id,v.textContent="Editar";const S=document.createElement("a");S.className="admin-action",S.href=vt(`p/${t.id}/`),S.textContent="Ver";const E=document.createElement("button");return E.type="button",E.className="admin-action is-danger",E.dataset.action="delete",E.dataset.id=t.id,E.textContent="Excluir",H.append(v,S,E),e.append(o,z,U,j,H),e},ct=t=>{if(l){if(l.innerHTML="",b=new Map,!t.length){const e=document.createElement("p");e.className="admin-empty",e.textContent="Nenhum post encontrado.",l.appendChild(e);return}t.forEach(e=>{b.set(e.id,e),l.appendChild(rt(e))})}},R=()=>{c&&(c.hidden=!m),d&&(d.hidden=!0)},tt=()=>{c&&(c.hidden=!0),d&&(d.hidden=!1)},dt=()=>{L&&L.reset(),u&&(u.readOnly=!1,u.classList.remove("is-readonly")),p&&(p.value="draft"),y&&(y.value="artigo"),h&&(h.value="")},lt=t=>{u&&(u.value=t.id,u.readOnly=!0,u.classList.add("is-readonly")),_&&(_.value=t.title),D&&(D.value=t.excerpt),y&&(y.value=t.type),F&&(F.value=t.tags.join(", ")),p&&(p.value=t.status),h&&(h.value=t.content)},ut=t=>/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(t),mt=t=>{const e=u?.value?.trim()??"";if(!e)return n("Slug obrigatorio.","error"),null;if(!ut(e))return n("Slug deve ser kebab-case.","error"),null;const o=_?.value?.trim()??"";if(!o)return n("Titulo obrigatorio.","error"),null;const a=D?.value?.trim()??"",s=y?.value||"artigo",r=(F?.value||"").split(",").map(j=>j.trim()).filter(Boolean),z=t||p?.value||"draft",U=h?.value??"";return{id:e,title:o,excerpt:a,type:s,tags:r,status:z,content:U}},N=async()=>{if(I)return I;const t=await et(()=>import("./firestore.3eO7oRFa.js"),__vite__mapDeps([0,1,2]));return I={listAllPostsAdmin:t.listAllPostsAdmin,getPostById:t.getPostById,upsertPostAdmin:t.upsertPostAdmin,deletePostAdmin:t.deletePostAdmin},I},O=async()=>{if(m)try{const e=await(await N()).listAllPostsAdmin();ct(e),g&&(g.textContent=String(e.length)),R()}catch(t){console.log(t),n("Nao foi possivel carregar posts.","error")}},ft=async t=>{if(m)try{const e=await N(),o=b.get(t)??await e.getPostById(t);if(!o){n("Post nao encontrado.","error");return}lt(o),tt()}catch(e){console.log(e),n("Nao foi possivel abrir o post.","error")}},q=async t=>{if(!m){n("Acesso admin necessario.","error");return}const e=mt(t);if(e){t&&p&&(p.value=t);try{await(await N()).upsertPostAdmin(e),n(t==="published"?"Post publicado.":"Post salvo.","success"),await O(),R()}catch(o){console.log(o),n("Nao foi possivel salvar o post.","error")}}},pt=async t=>{if(!m){n("Acesso admin necessario.","error");return}if(window.confirm("Excluir este post?"))try{await(await N()).deletePostAdmin(t),n("Post removido.","success"),await O()}catch(o){console.log(o),n("Nao foi possivel excluir o post.","error")}},gt=async t=>{if(!k)return!1;try{const e=await bt(wt(k,"admins",t)),o=e.exists()?e.data():null,a=!!(o&&o.active===!0);return Z(a),a}catch(e){return console.log(e),Z(!1),n("Nao foi possivel verificar permissao de admin.","error"),!1}};await(async()=>{try{const t=await et(()=>import("./client.DCNKASv_.js"),__vite__mapDeps([2,1]));return i=t.auth,k=t.db,!0}catch(t){console.log(t);const e=t instanceof Error?t.message:"Configuracao Firebase invalida. Verifique as variaveis de ambiente.";return n(e,"error"),!1}})()&&i&&Et(i,t=>{t?(at(t),n("Login ativo.","success"),gt(t.uid).then(e=>{e&&O()})):(st(),n("","info"))}),$&&$.addEventListener("submit",async t=>{if(t.preventDefault(),!i){n("Configuracao Firebase invalida. Verifique as variaveis de ambiente.","error");return}const e=W?.value?.trim(),o=V?.value||"";if(!e||!o){n("Preencha email e senha para entrar.","error");return}try{await yt(i,e,o),n("Login realizado.","success"),V&&(V.value="")}catch(a){console.log(a),n(T(a),"error")}}),G&&G.addEventListener("click",async()=>{if(!i){n("Configuracao Firebase invalida. Verifique as variaveis de ambiente.","error");return}const t=W?.value?.trim();if(!t){n("Informe o email para enviar o reset.","error");return}try{await ht(i,t),n("Email de recuperacao enviado.","success")}catch(e){console.log(e),n(T(e),"error")}}),J&&J.addEventListener("click",async()=>{if(!i){n("Configuracao Firebase invalida. Verifique as variaveis de ambiente.","error");return}try{await It(i),n("Sessao encerrada.","info")}catch(t){console.log(t),n(T(t),"error")}}),K&&K.addEventListener("click",()=>{m&&(dt(),tt())}),Q&&Q.addEventListener("click",()=>{R()}),L&&L.addEventListener("submit",t=>{t.preventDefault(),q()}),X&&X.addEventListener("click",()=>{q()}),Y&&Y.addEventListener("click",()=>{q("published")}),l&&l.addEventListener("click",t=>{const o=t.target?.closest("button");if(!o)return;const a=o.dataset.action,s=o.dataset.id;!a||!s||(a==="edit"&&ft(s),a==="delete"&&pt(s))})});
